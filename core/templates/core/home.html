{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="mb-4">Dashboard</h2>

  <div class="row g-4">
    <div class="col-md-4">
      <a href="{% url 'anagrafiche:fornitore_list' %}" class="text-decoration-none">
        <div class="card shadow-sm p-3 text-center h-100">
          <i class="bi bi-people-fill display-4 text-primary"></i>
          <h5 class="mt-3">Anagrafiche Fornitori</h5>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="{% url 'documenti:dichiarazione_list' %}" class="text-decoration-none">
        <div class="card shadow-sm p-3 text-center h-100">
          <i class="bi bi-file-earmark-text display-4 text-success"></i>
          <h5 class="mt-3">Dichiarazioni di Intento</h5>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="{% url 'documenti:fattura_list' %}" class="text-decoration-none">
        <div class="card shadow-sm p-3 text-center h-100">
          <i class="bi bi-receipt display-4 text-danger"></i>
          <h5 class="mt-3">Fatture Fornitori</h5>
        </div>
      </a>
    </div>
  </div>

  <h4 class="mt-5">Ultime Fatture Registrate</h4>
<table class="table table-sm table-hover mt-2">
  <thead>
    <tr>
      <th>Fornitore</th>
      <th>Numero</th>
      <th>Data</th>
      <th>Importo</th>
    </tr>
  </thead>
  <tbody>
    {% for fattura in ultime_fatture %}
    <tr>
      <td>{{ fattura.fornitore.ragione_sociale }}</td>
      <td>{{ fattura.numero_fattura }}</td>
      <td>{{ fattura.data_fattura|date:"d/m/Y" }}</td>
      <td>{{ fattura.importo|floatformat:2 }} €</td>
    </tr>
    {% empty %}
    <tr><td colspan="4">Nessuna fattura trovata.</td></tr>
    {% endfor %}
  </tbody>
</table>

{% if plafond_alert %}
<div class="alert alert-warning mt-4">
  <strong>Attenzione:</strong> i seguenti fornitori hanno quasi esaurito il plafond:
  <ul>
    {% for alert in plafond_alert %}
    <li>
      <strong>{{ alert.fornitore }}</strong> – Rimanente: {{ alert.rimanente|floatformat:2 }} € su {{ alert.plafond|floatformat:2 }} €
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %}



</div>
{% endblock %}
